<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exonova - My Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    :root {
      --primary: #ff5f6d;
      --secondary: #ffc371;
      --dark: #1e1e1e;
      --light: #f8f9fa;
      --gray: #6c757d;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --gold: #ffcf4d;
    }

    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body, html {
      height: 100%;
      overflow-x: hidden;
      background-color: #f5f5f5;
    }

    .container {
      display: flex;
      min-height: 100vh;
      background-color: #f8f9fa;
    }

    /* Sidebar Navigation */
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, #1e1e1e, #2d2d2d);
      color: white;
      padding: 30px 20px;
      box-shadow: 5px 0 15px rgba(0,0,0,0.1);
      position: fixed;
      height: 100%;
      z-index: 100;
      transition: all 0.3s ease;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar-header img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .sidebar-header h3 {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .sidebar-menu {
      list-style: none;
      margin-top: 20px;
    }

    .sidebar-menu li {
      margin-bottom: 10px;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .sidebar-menu a:hover, .sidebar-menu a.active {
      background: rgba(255,255,255,0.1);
      color: white;
    }

    .sidebar-menu a i {
      margin-right: 10px;
      font-size: 1.1rem;
    }

    .sidebar-footer {
      position: absolute;
      bottom: 30px;
      left: 20px;
      right: 20px;
    }

    .logout-btn {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 12px 15px;
      background: rgba(255,95,109,0.2);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: rgba(255,95,109,0.3);
    }

    .logout-btn i {
      margin-right: 10px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 30px;
      transition: all 0.3s ease;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .header h1 {
      font-size: 1.8rem;
      color: var(--dark);
      font-weight: 700;
    }

    .header-actions {
      display: flex;
      align-items: center;
    }

    .notification-btn {
      position: relative;
      margin-right: 20px;
      background: none;
      border: none;
      font-size: 1.2rem;
      color: var(--gray);
      cursor: pointer;
    }

    .notification-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-profile-btn {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      cursor: pointer;
    }

    .user-profile-btn img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .user-profile-btn span {
      font-weight: 500;
      color: var(--dark);
    }

    /* Profile Card */
    .profile-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      padding: 30px;
      margin-bottom: 30px;
    }

    .profile-header {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
    }

    .profile-avatar {
      position: relative;
      margin-right: 30px;
    }

    .profile-avatar img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid #f1f1f1;
    }

    .avatar-upload {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background: var(--primary);
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .avatar-upload input {
      display: none;
    }

    .profile-info h2 {
      font-size: 1.8rem;
      margin-bottom: 5px;
      color: var(--dark);
    }

    .profile-info p {
      color: var(--gray);
      margin-bottom: 15px;
    }

    .profile-stats {
      display: flex;
      margin-bottom: 20px;
    }

    .stat-item {
      margin-right: 30px;
    }

    .stat-item h3 {
      font-size: 1.5rem;
      color: var(--dark);
      margin-bottom: 5px;
    }

    .stat-item p {
      color: var(--gray);
      font-size: 0.9rem;
    }

    .profile-bio {
      margin-bottom: 30px;
    }

    .profile-bio p {
      color: var(--gray);
      line-height: 1.6;
    }

    .edit-bio-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 0.9rem;
      cursor: pointer;
      margin-top: 10px;
    }

    /* Profile Form */
    .profile-form {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255,95,109,0.2);
      outline: none;
    }

    .form-actions {
      grid-column: span 2;
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,95,109,0.3);
    }

    .btn-outline {
      background: none;
      border: 1px solid #ddd;
      color: var(--gray);
      margin-right: 15px;
    }

    .btn-outline:hover {
      background: #f8f9fa;
    }

    /* Courses Section */
    .courses-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      padding: 30px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-header h2 {
      font-size: 1.5rem;
      color: var(--dark);
    }

    .view-all {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }

    .courses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .course-card {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .course-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .course-thumbnail {
      height: 160px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      position: relative;
      overflow: hidden;
    }

    .course-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .course-category {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
    }

    .course-details {
      padding: 20px;
    }

    .course-title {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--dark);
    }

    .course-instructor {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .course-instructor img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .course-instructor span {
      font-size: 0.9rem;
      color: var(--gray);
    }

    .course-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .course-rating {
      display: flex;
      align-items: center;
      color: var(--gold);
    }

    .course-rating i {
      font-size: 0.9rem;
      margin-right: 5px;
    }

    .course-price {
      font-weight: 600;
      color: var(--primary);
    }

    /* Responsive Styles */
    @media (max-width: 992px) {
      .sidebar {
        width: 250px;
      }
      .main-content {
        margin-left: 250px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 280px;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
      .profile-header {
        flex-direction: column;
        text-align: center;
      }
      .profile-avatar {
        margin-right: 0;
        margin-bottom: 20px;
      }
      .profile-stats {
        justify-content: center;
      }
      .profile-form {
        grid-template-columns: 1fr;
      }
      .form-actions {
        grid-column: span 1;
      }
    }

    @media (max-width: 576px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-actions {
        margin-top: 15px;
      }
      .profile-card, .courses-section {
        padding: 20px;
      }
    }

    /* Toggle Button for Mobile */
    .menu-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--primary);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    @media (max-width: 768px) {
      .menu-toggle {
        display: flex;
      }
    }

    /* Loading Animation */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,95,109,0.2);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--dark);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast i {
      margin-right: 10px;
      font-size: 1.2rem;
    }

    .toast.success i {
      color: var(--success);
    }

    .toast.error i {
      color: var(--danger);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toast-message">Profile updated successfully!</span>
  </div>

  <!-- Mobile Menu Toggle -->
  <div class="menu-toggle" id="menuToggle">
    <i class="fas fa-bars"></i>
  </div>

  <!-- Sidebar Navigation -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <img src="https://ui-avatars.com/api/?name=John+Doe&background=ff5f6d&color=fff" alt="User Avatar" id="sidebar-avatar">
      <h3 id="sidebar-username">John Doe</h3>
    </div>
    <ul class="sidebar-menu">
      <li><a href="#" class="active"><i class="fas fa-user"></i> Profile</a></li>
      <li><a href="#"><i class="fas fa-book"></i> My Courses</a></li>
      <li><a href="#"><i class="fas fa-certificate"></i> Certificates</a></li>
      <li><a href="#"><i class="fas fa-heart"></i> Wishlist</a></li>
      <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
      <li><a href="#"><i class="fas fa-question-circle"></i> Help</a></li>
    </ul>
    <div class="sidebar-footer">
      <button class="logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i> Log Out
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <div class="header">
      <h1>My Profile</h1>
      <div class="header-actions">
        <button class="notification-btn">
          <i class="fas fa-bell"></i>
          <span class="notification-count">3</span>
        </button>
        <button class="user-profile-btn">
          <img src="https://ui-avatars.com/api/?name=John+Doe&background=ff5f6d&color=fff" alt="User Avatar" id="header-avatar">
          <span id="header-username">John Doe</span>
        </button>
      </div>
    </div>

    <!-- Profile Card -->
    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-avatar">
          <img src="https://ui-avatars.com/api/?name=John+Doe&background=ff5f6d&color=fff" alt="Profile Avatar" id="profile-avatar">
          <label class="avatar-upload">
            <input type="file" id="avatarInput" accept="image/*">
            <i class="fas fa-camera"></i>
          </label>
        </div>
        <div class="profile-info">
          <h2 id="profile-name">John Doe</h2>
          <p id="profile-email">john.doe@example.com</p>
          <div class="profile-stats">
            <div class="stat-item">
              <h3 id="courses-count">12</h3>
              <p>Courses</p>
            </div>
            <div class="stat-item">
              <h3 id="certificates-count">5</h3>
              <p>Certificates</p>
            </div>
            <div class="stat-item">
              <h3 id="xp-count">1240</h3>
              <p>XP Points</p>
            </div>
          </div>
        </div>
      </div>
      <div class="profile-bio">
        <h3>About Me</h3>
        <p id="profile-bio">I'm a passionate learner interested in web development, data science, and UX design. Currently focusing on improving my JavaScript skills.</p>
        <button class="edit-bio-btn" id="editBioBtn"><i class="fas fa-edit"></i> Edit Bio</button>
      </div>

      <!-- Profile Form -->
      <form id="profileForm">
        <div class="profile-form">
          <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" class="form-control" value="John" required>
          </div>
          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" class="form-control" value="Doe" required>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" class="form-control" value="john.doe@example.com" required disabled>
          </div>
          <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" class="form-control" value="+1 (555) 123-4567">
          </div>
          <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" class="form-control" value="New York, USA">
          </div>
          <div class="form-group">
            <label for="occupation">Occupation</label>
            <input type="text" id="occupation" class="form-control" value="Web Developer">
          </div>
          <div class="form-group">
            <label for="education">Education</label>
            <input type="text" id="education" class="form-control" value="Computer Science, MIT">
          </div>
          <div class="form-group">
            <label for="skills">Skills</label>
            <input type="text" id="skills" class="form-control" value="JavaScript, React, Node.js, Python">
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </div>
      </form>
    </div>

    <!-- Courses Section -->
    <div class="courses-section">
      <div class="section-header">
        <h2>My Courses</h2>
        <a href="#" class="view-all">View All</a>
      </div>
      <div class="courses-grid">
        <!-- Course Card 1 -->
        <div class="course-card">
          <div class="course-thumbnail">
            <img src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Course Thumbnail">
            <span class="course-category">Web Development</span>
          </div>
          <div class="course-details">
            <h3 class="course-title">Advanced JavaScript</h3>
            <div class="course-instructor">
              <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Instructor">
              <span>Alex Johnson</span>
            </div>
            <div class="course-meta">
              <div class="course-rating">
                <i class="fas fa-star"></i>
                <span>4.8</span>
              </div>
              <div class="course-price">$79.99</div>
            </div>
          </div>
        </div>

        <!-- Course Card 2 -->
        <div class="course-card">
          <div class="course-thumbnail">
            <img src="https://images.unsplash.com/photo-1542626991-cbc4e32524cc?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Course Thumbnail">
            <span class="course-category">Data Science</span>
          </div>
          <div class="course-details">
            <h3 class="course-title">Python for Data Analysis</h3>
            <div class="course-instructor">
              <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Instructor">
              <span>Sarah Miller</span>
            </div>
            <div class="course-meta">
              <div class="course-rating">
                <i class="fas fa-star"></i>
                <span>4.7</span>
              </div>
              <div class="course-price">$89.99</div>
            </div>
          </div>
        </div>

        <!-- Course Card 3 -->
        <div class="course-card">
          <div class="course-thumbnail">
            <img src="https://images.unsplash.com/photo-1517694712202-14dd9538aa97?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Course Thumbnail">
            <span class="course-category">UI/UX Design</span>
          </div>
          <div class="course-details">
            <h3 class="course-title">Figma Masterclass</h3>
            <div class="course-instructor">
              <img src="https://randomuser.me/api/portraits/men/22.jpg" alt="Instructor">
              <span>Michael Chen</span>
            </div>
            <div class="course-meta">
              <div class="course-rating">
                <i class="fas fa-star"></i>
                <span>4.9</span>
              </div>
              <div class="course-price">$69.99</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB7F1uRRiGdw489c_18aJeodbxrzsdFb5c",
      authDomain: "exonova-cd89c.firebaseapp.com",
      projectId: "exonova-cd89c",
      storageBucket: "exonova-cd89c.firebasestorage.app",
      messagingSenderId: "465326262278",
      appId: "1:465326262278:web:1b7f8f62e1f46c5ca7db87",
      measurementId: "G-GGG45V0PEF"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // DOM Elements
    const loadingScreen = document.getElementById('loading');
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const logoutBtn = document.getElementById('logoutBtn');
    const profileForm = document.getElementById('profileForm');
    const cancelBtn = document.getElementById('cancelBtn');
    const editBioBtn = document.getElementById('editBioBtn');
    const avatarInput = document.getElementById('avatarInput');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');

    // User data elements
    const profileAvatar = document.getElementById('profile-avatar');
    const sidebarAvatar = document.getElementById('sidebar-avatar');
    const headerAvatar = document.getElementById('header-avatar');
    const profileName = document.getElementById('profile-name');
    const sidebarUsername = document.getElementById('sidebar-username');
    const headerUsername = document.getElementById('header-username');
    const profileEmail = document.getElementById('profile-email');
    const profileBio = document.getElementById('profile-bio');
    const firstName = document.getElementById('firstName');
    const lastName = document.getElementById('lastName');
    const email = document.getElementById('email');
    const phone = document.getElementById('phone');
    const locationInput = document.getElementById('location');
    const occupation = document.getElementById('occupation');
    const education = document.getElementById('education');
    const skills = document.getElementById('skills');
    const coursesCount = document.getElementById('courses-count');
    const certificatesCount = document.getElementById('certificates-count');
    const xpCount = document.getElementById('xp-count');

    // Toggle sidebar on mobile
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('active');
    });

    // Show toast notification
    function showToast(message, isSuccess = true) {
      const toastIcon = toast.querySelector('i');
      toastIcon.className = isSuccess ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
      toast.className = isSuccess ? 'toast success' : 'toast error';
      toastMessage.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Logout function
    logoutBtn.addEventListener('click', () => {
      signOut(auth).then(() => {
        window.location.href = 'signin.html';
      }).catch((error) => {
        showToast('Logout failed: ' + error.message, false);
      });
    });

    // Update profile picture
    avatarInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const user = auth.currentUser;
        if (user) {
          const storageRef = ref(storage, `profile_pictures/${user.uid}`);
          
          // Show loading
          loadingScreen.style.display = 'flex';
          
          uploadBytes(storageRef, file).then(() => {
            return getDownloadURL(storageRef);
          }).then((downloadURL) => {
            // Update all avatar images on the page
            profileAvatar.src = downloadURL;
            sidebarAvatar.src = downloadURL;
            headerAvatar.src = downloadURL;
            
            // Update in Firestore
            const userRef = doc(db, 'users', user.uid);
            return updateDoc(userRef, {
              photoURL: downloadURL
            });
          }).then(() => {
            showToast('Profile picture updated successfully!');
          }).catch((error) => {
            showToast('Error updating profile picture: ' + error.message, false);
          }).finally(() => {
            loadingScreen.style.display = 'none';
          });
        }
      }
    });

    // Edit bio button
    editBioBtn.addEventListener('click', () => {
      const currentBio = profileBio.textContent;
      const newBio = prompt('Edit your bio:', currentBio);
      
      if (newBio !== null && newBio !== currentBio) {
        const user = auth.currentUser;
        if (user) {
          const userRef = doc(db, 'users', user.uid);
          
          updateDoc(userRef, {
            bio: newBio
          }).then(() => {
            profileBio.textContent = newBio;
            showToast('Bio updated successfully!');
          }).catch((error) => {
            showToast('Error updating bio: ' + error.message, false);
          });
        }
      }
    });

    // Form submission
    profileForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const user = auth.currentUser;
      if (user) {
        const userRef = doc(db, 'users', user.uid);
        const updatedData = {
          firstName: firstName.value,
          lastName: lastName.value,
          phone: phone.value,
          location: locationInput.value,
          occupation: occupation.value,
          education: education.value,
          skills: skills.value,
          updatedAt: new Date()
        };
        
        // Show loading
        loadingScreen.style.display = 'flex';
        
        updateDoc(userRef, updatedData)
          .then(() => {
            // Update displayed name
            const fullName = `${firstName.value} ${lastName.value}`;
            profileName.textContent = fullName;
            sidebarUsername.textContent = fullName;
            headerUsername.textContent = fullName;
            
            showToast('Profile updated successfully!');
          })
          .catch((error) => {
            showToast('Error updating profile: ' + error.message, false);
          })
          .finally(() => {
            loadingScreen.style.display = 'none';
          });
      }
    });

    // Cancel button
    cancelBtn.addEventListener('click', () => {
      // Reset form to current user data
      loadUserData();
    });

    // Load user data
    function loadUserData() {
      onAuthStateChanged(auth, (user) => {
        if (user) {
          const userRef = doc(db, 'users', user.uid);
          
          getDoc(userRef).then((docSnap) => {
            if (docSnap.exists()) {
              const userData = docSnap.data();
              
              // Set profile data
              const fullName = `${userData.firstName || 'User'} ${userData.lastName || ''}`.trim();
              profileName.textContent = fullName;
              sidebarUsername.textContent = fullName;
              headerUsername.textContent = fullName;
              
              // Set email
              profileEmail.textContent = user.email;
              email.value = user.email;
              
              // Set other fields
              firstName.value = userData.firstName || '';
              lastName.value = userData.lastName || '';
              phone.value = userData.phone || '';
              locationInput.value = userData.location || '';
              occupation.value = userData.occupation || '';
              education.value = userData.education || '';
              skills.value = userData.skills || '';
              profileBio.textContent = userData.bio || 'No bio yet. Click edit to add one.';
              
              // Set stats
              coursesCount.textContent = userData.coursesCount || '0';
              certificatesCount.textContent = userData.certificatesCount || '0';
              xpCount.textContent = userData.xpPoints || '0';
              
              // Set avatar
              const avatarUrl = userData.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(fullName)}&background=ff5f6d&color=fff`;
              profileAvatar.src = avatarUrl;
              sidebarAvatar.src = avatarUrl;
              headerAvatar.src = avatarUrl;
              
              // Hide loading screen
              loadingScreen.style.display = 'none';
            } else {
              // User document doesn't exist, create it
              const userRef = doc(db, 'users', user.uid);
              const userName = user.displayName || 'User';
              
              updateDoc(userRef, {
                firstName: userName.split(' ')[0],
                lastName: userName.split(' ')[1] || '',
                email: user.email,
                createdAt: new Date(),
                photoURL: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=ff5f6d&color=fff`
              }).then(() => {
                // Reload data
                loadUserData();
              });
            }
          });
        } else {
          // No user is signed in, redirect to sign in
          window.location.href = 'signin.html';
        }
      });
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', () => {
      loadUserData();
    });
  </script>
</body>
</html>
